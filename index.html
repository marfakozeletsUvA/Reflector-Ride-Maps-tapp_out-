<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  <title>Bike Sensor Data Visualization</title>
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <link href="https://unpkg.com/maplibre-gl@3.6.2/dist/maplibre-gl.css" rel="stylesheet" />
  <link href="styles.css" rel="stylesheet" />
  <script src="https://unpkg.com/maplibre-gl@3.6.2/dist/maplibre-gl.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/@turf/turf@6/turf.min.js"></script>
  <script src="https://unpkg.com/pmtiles@3.0.4/dist/pmtiles.js"></script>
  <script>
    var mapboxgl = maplibregl;
  </script>
</head>
<body>
<div id="mapContainer">
  <button id="fullscreenBtn" title="Toggle Fullscreen">‚õ∂</button>
  
  <div id="map"></div>

  <div id="controls">
    <h3>üö¥ Bike Routes</h3>

    <div class="control-group">
    <label>üîç Find Trip:</label>
    <div style="display: flex; gap: 5px;">
      <input type="text" id="tripSearchInput" placeholder="e.g., 602CA_Trip1" 
            style="flex: 1; padding: 5px; border: 1px solid #ccc; border-radius: 4px;">
      <button id="tripSearchButton" style="padding: 5px 10px;">Search</button>
    </div>
  </div>
    
    <div class="control-group">
      <label class="checkbox-label">
        <input type="checkbox" id="speedColorsCheckbox">
        Show Speed Colors
      </label>
    </div>
    
    <div class="radio-group" id="speedModeGroup">
      <label class="radio-label">
        <input type="radio" name="speedMode" value="gradient" checked>
        Smooth Gradient
      </label>
      <label class="radio-label">
        <input type="radio" name="speedMode" value="categories">
        Speed Categories
      </label>
    </div>

    <div class="control-group">
      <label class="checkbox-label">
        <input type="checkbox" id="roadQualityCheckbox">
        Show Road Quality
      </label>
    </div>

    <button id="resetButton">‚Ü© Reset View</button>
  </div>

  <div id="stats">
    <h4>Trip Info</h4>
    <div class="stat-row" id="statTripRow">
      <span class="stat-label">Total trips:</span>
      <span class="stat-value" id="statTrips">‚Äî</span>
    </div>
    <div class="stat-row" id="statDistanceRow">
      <span class="stat-label">Total distance:</span>
      <span class="stat-value" id="statDistance">‚Äî</span>
    </div>
    <div class="stat-row" id="statAvgSpeedRow">
      <span class="stat-label">Average speed:</span>
      <span class="stat-value" id="statAvgSpeed">‚Äî</span>
    </div>
    <div class="stat-row" id="statTotalTimeRow">
      <span class="stat-label">Total time:</span>
      <span class="stat-value" id="statTotalTime">‚Äî</span>
    </div>
    <div class="stat-row" id="selectedTripRow">
      <span class="stat-label">Selected:</span>
      <span class="stat-value" id="selectedTrip">‚Äî</span>
    </div>
  </div>

  <div class="legend" id="speedLegend">
    <h4>Speed (km/h)</h4>
    <div class="speed-legend-item">
      <div class="speed-color-box" style="background: #808080;"></div>
      <span>Stopped (0-2)</span>
    </div>
    <div class="speed-legend-item">
      <div class="speed-color-box" style="background: #DC2626;"></div>
      <span>Very Slow (2-5)</span>
    </div>
    <div class="speed-legend-item">
      <div class="speed-color-box" style="background: #F97316;"></div>
      <span>Slow (5-10)</span>
    </div>
    <div class="speed-legend-item">
      <div class="speed-color-box" style="background: #FACC15;"></div>
      <span>Moderate (10-15)</span>
    </div>
    <div class="speed-legend-item">
      <div class="speed-color-box" style="background: #22C55E;"></div>
      <span>Fast (15-20)</span>
    </div>
    <div class="speed-legend-item">
      <div class="speed-color-box" style="background: #3B82F6;"></div>
      <span>Very Fast (20-25)</span>
    </div>
    <div class="speed-legend-item">
      <div class="speed-color-box" style="background: #6366F1;"></div>
      <span>Extreme (25+)</span>
    </div>
  </div>

  <div class="legend" id="roadQualityLegend">
    <h4>Road Quality</h4>
    <div class="speed-legend-item">
      <div class="speed-color-box" style="background: #22C55E;"></div>
      <span>1 - Perfect</span>
    </div>
    <div class="speed-legend-item">
      <div class="speed-color-box" style="background: #84CC16;"></div>
      <span>2 - Normal</span>
    </div>
    <div class="speed-legend-item">
      <div class="speed-color-box" style="background: #FACC15;"></div>
      <span>3 - Outdated</span>
    </div>
    <div class="speed-legend-item">
      <div class="speed-color-box" style="background: #F97316;"></div>
      <span>4 - Bad</span>
    </div>
    <div class="speed-legend-item">
      <div class="speed-color-box" style="background: #DC2626;"></div>
      <span>5 - No road</span>
    </div>
    <div class="speed-legend-item">
      <div class="speed-color-box" style="background: #808080;"></div>
      <span>Unknown</span>
    </div>
  </div>
</div>

<script>
  // Fullscreen functionality
  const fullscreenBtn = document.getElementById('fullscreenBtn');
  const mapContainer = document.getElementById('mapContainer');
  
  fullscreenBtn.addEventListener('click', () => {
    if (!document.fullscreenElement && 
        !document.webkitFullscreenElement && 
        !document.mozFullScreenElement && 
        !document.msFullscreenElement) {
      if (mapContainer.requestFullscreen) {
        mapContainer.requestFullscreen();
      } else if (mapContainer.webkitRequestFullscreen) {
        mapContainer.webkitRequestFullscreen();
      } else if (mapContainer.mozRequestFullScreen) {
        mapContainer.mozRequestFullScreen();
      } else if (mapContainer.msRequestFullscreen) {
        mapContainer.msRequestFullscreen();
      }
      fullscreenBtn.textContent = '‚õ∂';
    } else {
      if (document.exitFullscreen) {
        document.exitFullscreen();
      } else if (document.webkitExitFullscreen) {
        document.webkitExitFullscreen();
      } else if (document.mozCancelFullScreen) {
        document.mozCancelFullScreen();
      } else if (document.msExitFullscreen) {
        document.msExitFullscreen();
      }
      fullscreenBtn.textContent = '‚õ∂';
    }
  });
  
  document.addEventListener('fullscreenchange', updateFullscreenButton);
  document.addEventListener('webkitfullscreenchange', updateFullscreenButton);
  document.addEventListener('mozfullscreenchange', updateFullscreenButton);
  document.addEventListener('MSFullscreenChange', updateFullscreenButton);
  
  function updateFullscreenButton() {
    if (document.fullscreenElement || 
        document.webkitFullscreenElement || 
        document.mozFullScreenElement || 
        document.msFullscreenElement) {
      fullscreenBtn.textContent = '‚õ∂';
      fullscreenBtn.title = 'Exit Fullscreen';
    } else {
      fullscreenBtn.textContent = '‚õ∂';
      fullscreenBtn.title = 'Enter Fullscreen';
    }
  }
</script>

<script type="module" src="config.js"></script>
<script type="module" src="app.js"></script>
</body>
</html>